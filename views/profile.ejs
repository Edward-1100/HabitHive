<!doctype html>

<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <link rel="icon" type="image/png" href="/images/honeycomb.png">
    <title><%= user && user.username ? user.username : 'Profile' %>'s Profile</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>

  <body>
    <%- include('partials/nav') %>

    <main class="container">

      <div class="profile-card">

        <div class="profile-header">

          <div>
            <img
              src="<%= user.profileImage && user.profileImage.length ? user.profileImage : '/images/honeycomb.png' %>"
              alt="<%= user.username %>'s avatar"
              class="profile-avatar-img"
            >
          </div>

          <div class="profile-meta">
            <h2><%= user.username %></h2>
            <div class="muted">Joined: <%= (new Date(user.createdAt)).toDateString() %></div>
            <div class="muted">Role: <%= user.isAdmin ? "Admin" : "User" %></div>
          </div>

        </div>

        <div class="stats-grid">

          <div class="stat-box">
            <h3><%= typeof user.points === 'number' ? user.points : 0 %></h3>
            <span>Points</span>
          </div>

          <div class="stat-box">
            <h3><%= typeof habitsCount === 'number' ? habitsCount : 0 %></h3>
            <span>Total Habits</span>
          </div>

          <div class="stat-box">
            <h3><%= typeof completedCount === 'number' ? completedCount : 0 %></h3>
            <span>Completed</span>
          </div>

          <div class="stat-box">
            <h3><%= typeof streak === 'number' ? streak : 0 %></h3>
            <span>Current Streak</span>
          </div>

        </div>

      </div>

      <div class="section">

        <h3>Recent Activity</h3>

        <div style="margin-top:12px; display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:8px;">
          <div class="muted">Last 7 days</div>
          <div class="muted">Today: <strong><%= new Date().toDateString() %></strong></div>
        </div>

        <div class="calendar" aria-label="Recent 7 days">
          <% if (recentDays && recentDays.length) { %>
            <% recentDays.forEach(function(day) { %>
              <div class="cal-day <%= day.bucket %>" data-date="<%= day.date %>">
                <div class="dateNum"><%= Number(day.date.slice(-2)) %></div>
                <div class="dot"><%= day.completedCount %>/<%= day.total %></div>
              </div>
            <% }) %>
          <% } else { %>
            <p class="muted">No data for recent days.</p>
          <% } %>
        </div>


      <div class="section">
        <h3>Actions</h3>
        <a href="/rewards" class="btn">View Rewards</a>
        <a href="/habits" class="btn">Manage Habits</a>
        <a href="/profile/<%= user._id %>/edit" class="btn">Edit Profile</a>
      </div>

    </main>

  </body>

</html>
