<!doctype html>

<html lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/png" href="/images/honeycomb.png">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>

  <body>

    <%- include('../partials/nav') %>

    <main class="container">
      <h1>Admin Panel</h1>

      <p class="muted">General Admin Panel. <a href="/admin/habits">Habit Panel</a>  |  <a href="Moderation Panel">Moderation Panel</a></p>

      <% if (!users || users.length === 0) { %>
        <p>No users found.</p>
      <% } else { %>

        <table class="admin-table" role="table" aria-label="Users">
          <thead>
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Points</th>
              <th>Profile</th>
              <th>Admin</th>
              <th>Promote</th>
            </tr>
          </thead>

          <tbody>
            <% let totalPoints = 0; %>
            <% users.forEach(u => { %>
              <tr>
                <td><%= u.username %></td>
                <td><%= u.email %></td>

                <td>
                  <form class="inline" action="/admin/update-points/<%= u._id %>" method="POST">
                    <input class="points-input" type="number" name="points" value="<%= u.points || 0 %>" min="0" />
                    <button class="small-btn" type="submit">Save</button>
                  </form>
                </td>

                <td>
                  <a class="small-btn" href="/profile/<%= u._id %>">View</a>
                </td>

                <td><%= u.isAdmin ? 'Yes' : 'No' %></td>

                <td>
                  <form class="inline" action="/admin/toggle-admin/<%= u._id %>" method="POST" onsubmit="return confirm('Toggle admin status for <%= u.username %>?');">
                    <button class="small-btn" type="submit"><%= u.isAdmin ? 'Remove Admin' : 'Make Admin' %></button>
                  </form>
                </td>

              </tr>

            <% }) %>

          </tbody>

        </table>

      <% } %>

    </main>
    
  </body>

</html>
